{% assign s = include.section %}

<div class="SeminarElement section">
  <!-- <div class="Left blank"></div> -->
  <div class="Partition section"></div>
  <div class="Middle section">
    <div class="TimeFrame">
      <div class="TimeFrame left">Session {{ s.num }} </div>
      <div class="TimeFrame right">{{ s.time }}</div>
    </div>
    {% if s.title %}
      <div class="TextFrame">
        <div class="Text title">{{ s.title }}</div>


        <div class="expandable">
          <div class="excerpt">
            <!-- 요약본 내용 -->
            {% if s.name %} <div class="Text name">연사 | {{ s.name }}</div> {% endif %}
          </div>

          <div class="full" hidden>
            <!-- 전체 내용 -->
            {% if s.abstr %} <div class="Text abstr">{{ s.abstr | markdownify }}</div> {% endif %}
            {% if s.name %} <div class="Text name">연사 | {{ s.name }}</div> {% endif %}
            {% if s.intro %} <div class="Text intro">{{ s.intro | markdownify }}</div> {% endif %}
          </div>

          <button class="toggle" type="button" aria-expanded="false">더보기</button>
        </div>



        <!-- <div class="expandable" id="exp1">
          <div class="excerpt">
            {% if s.name %} <div class="Text name">연사 | {{ s.name }}</div> {% endif %}
          </div>

          <div class="full" id="exp1-panel" aria-hidden="true">
            {% if s.abstr %} <div class="Text abstr">{{ s.abstr | markdownify }}</div> {% endif %}
            {% if s.name %} <div class="Text name">연사 | {{ s.name }}</div> {% endif %}
            {% if s.intro %} <div class="Text intro">{{ s.intro | markdownify }}</div> {% endif %}
          </div>

          <button class="toggle" type="button" aria-expanded="false" aria-controls="exp1-panel">
            더보기
          </button>
        </div> -->



        <!-- {% if s.abstr %} <div class="Text abstr">{{ s.abstr | markdownify }}</div> {% endif %}
        {% if s.name %} <div class="Text name">연사 | {{ s.name }}</div> {% endif %}
        {% if s.intro %} <div class="Text intro">{{ s.intro | markdownify }}</div> {% endif %} -->
      </div>
    {% endif %}
    {% if s.session %}
      <div class="SessionFrame">
        <div class="Text session">{{s.session}}</div>
        {% if s.description %} <div class="Text description">{{s.description}}</div> {% endif %}
      </div>
    {% endif %}
  </div>
  <div class="Right section">
    {% if s.photo %} <img src="{{ s.photo | relative_url }}" alt="{{ s.name }}" class="Photo"> {% endif %}
    {% if s.sessionPhoto %} <img src="{{ s.sessionPhoto | relative_url }}" alt="{{ s.name }}" class="sessionPhoto"> {% endif %}
  </div>
</div>




<script>
  // Bind once globally to avoid duplicate listeners from repeated includes
  if (!window.__expandableInit) {
    window.__expandableInit = true;
    document.addEventListener('click', (e) => {
      const toggleBtn = e.target.closest('.expandable .toggle');
      if (!toggleBtn) return;

      const box = toggleBtn.closest('.expandable');
      if (!box) return;

      const wasExpanded = box.classList.contains('is-expanded');
      const willExpand = !wasExpanded;
      box.classList.toggle('is-expanded');

      const excerptEl = box.querySelector('.excerpt');
      const fullEl = box.querySelector('.full');

      // Ensure elements exist
      if (!fullEl || !excerptEl) return;

      // Helper: animate height for smooth transition
      const animate = (expand) => {
        fullEl.style.overflow = 'hidden';
        fullEl.style.transition = 'height 280ms cubic-bezier(0.2, 0.0, 0.2, 1)';

        if (expand) {
          // Show full content and animate from 0 -> scrollHeight
          excerptEl.hidden = true;
          fullEl.hidden = false;
          fullEl.style.height = '0px';
          // Force reflow
          void fullEl.offsetHeight;
          const endH = fullEl.scrollHeight;
          fullEl.style.height = endH + 'px';
          const onEnd = () => {
            fullEl.style.height = '';
            fullEl.style.transition = '';
            fullEl.style.overflow = '';
            fullEl.removeEventListener('transitionend', onEnd);
          };
          fullEl.addEventListener('transitionend', onEnd);
        } else {
          // Collapse: measure current height, animate to 0, then hide
          excerptEl.hidden = true; // keep excerpt hidden until collapse finishes
          const startH = fullEl.scrollHeight;
          fullEl.style.height = startH + 'px';
          // Force reflow
          void fullEl.offsetHeight;
          fullEl.style.height = '0px';
          const onEnd = () => {
            fullEl.hidden = true;
            excerptEl.hidden = false;
            fullEl.style.height = '';
            fullEl.style.transition = '';
            fullEl.style.overflow = '';
            fullEl.removeEventListener('transitionend', onEnd);
          };
          fullEl.addEventListener('transitionend', onEnd);
        }
      };

      // Run animation
      animate(willExpand);

      // Update button a11y and label
      toggleBtn.setAttribute('aria-expanded', String(willExpand));
      toggleBtn.textContent = willExpand ? '접기' : '더보기';

      // Temporarily disable scroll snapping when any expandable is open
      const mainBody = document.querySelector('.MainPageBody');
      if (mainBody) {
        const anyOpen = document.querySelector('.expandable.is-expanded');
        mainBody.classList.toggle('no-snap', Boolean(anyOpen));
      }
    });
  }
  </script>
